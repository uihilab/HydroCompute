

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> javascript/js.worker.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-kernels.html">kernels</a></li><li><a href="Worker.module_GPUWorker.html">GPUWorker</a></li><li><a href="Workers.module_JSWorker.html">JSWorker</a></li><li><a href="Workers.module_WASMWorker.html">WASMWorker</a></li></ul><h3>Namespaces</h3><ul><li><a href="ErrorTypes.html">ErrorTypes</a></li><li><a href="globalUtils.html">globalUtils</a></li><li><a href="gpuScripts.html">gpuScripts</a></li><li><a href="gpuUtils.html">gpuUtils</a></li><li><a href="jsScripts.html">jsScripts</a></li><li><a href="splits.html">splits</a></li><li><a href="WASMUtils.html">WASMUtils</a></li></ul><h3>Classes</h3><ul><li><a href="engine.html">engine</a></li><li><a href="hydroCompute.html">hydroCompute</a></li><li><a href="threadManager.html">threadManager</a></li><li><a href="WebRTC.html">WebRTC</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>javascript/js.worker.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { getPerformanceMeasures } from "../core/utils/globalUtils.js";

/**
 * @description JavaScript worker for executing JS scripts and functions. The worker does not utilize any subset functions to call any computation and runs directly based on the implementation of the underlying scripts.
 * @memberof Workers
 * @module WebWorker
 * @name JSWorker
 */
self.onmessage = async (e) => {
  performance.mark("start-script");
  const { funcName, id, step, scriptName } = e.data;

  // Convert the incoming data into a Float32Array
  let data = new Float32Array(e.data.data);

  // Load the script file dynamically
  let scripts;
  if (scriptName) {
    scripts = await import(`../../${scriptName}`);
    //using the inner object saved in the default variable
    scripts = scripts.default
  } else {
    scripts = await import("./scripts/scripts.js");
  }
  
  let result = null;

  try {
    if (scriptName !== undefined) {
      performance.mark("start-function");

      // Check if the 'main' function is defined in the script
      if (Object.keys(scripts).includes("main") &amp;&amp;
          Object.keys(scripts).includes(funcName) &amp;&amp; funcName !== "main") {
        result = new Float32Array(scripts["main"](funcName, [...data]));
      } else if (!Object.keys(scripts).includes("main")) {
        result = new Float32Array(scripts[funcName]([...data]));
      } else if ((funcName === undefined || funcName === "main") &amp;&amp; Object.keys(scripts).includes("main")){
        result = new Float32Array(scripts["main"]([...data]));
      }

      performance.mark("end-function");
    } else {
      // Search for the function in the available scripts in js library
      for (const script in scripts) {
        if (Object.keys(scripts[script]).includes("main") &amp;&amp;
            Object.keys(scripts[script]).includes(funcName)) {
          performance.mark("start-function");
          result = new Float32Array(scripts[script]["main"](funcName, [...data]));
          performance.mark("end-function");
          break;
        } else if (!Object.keys(scripts[script]).includes("main") &amp;&amp;
                   Object.keys(scripts[script]).includes(funcName)) {
          performance.mark("start-function");
          result = new Float32Array(scripts[script][funcName]([...data]));
          performance.mark("end-function");
          break;
        }
      }
    }

    performance.mark("end-script");

    // Get performance measures using the `getPerformanceMeasures()` function from the 'globalUtils.js' module
    let getPerformance = getPerformanceMeasures();

    // Send back the results and performance measures to the main thread
    self.postMessage({
      id,
      results: result.buffer,
      step,
      funcName,
      ...getPerformance
    }, [result.buffer]);
  } catch (error) {
    // Handle errors that may occur during script execution
    if (!(error instanceof DOMException) &amp;&amp; typeof scripts !== "undefined") {
      console.error(
        `There was an error executing:\nfunction: ${funcName}\nid: ${id} at the worker.`,
      );
      throw error;
    } else {
      console.error("There was an error running the javascript worker script.");
      throw error;
    }
  }
};

</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
